<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://activiti.com/modeler" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/processdef" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd" modeler:version="1.0en" modeler:exportDateTime="20150216104339475" modeler:modelId="933057" modeler:modelVersion="3" modeler:modelLastUpdated="1424083415708" exporter="camunda modeler" exporterVersion="2.7.0">
  <process id="annualReview" name="Enterprise Review Process" isExecutable="true">
    <startEvent id="anualReviewStart" name="Start"></startEvent>
    <sequenceFlow id="SequenceFlow_1" sourceRef="anualReviewStart" targetRef="startProcessEmailServiceTask"></sequenceFlow>
    <serviceTask id="startProcessEmailServiceTask" name="Start Process Mail" activiti:expression="${mailService.sendAnnualReviewStartedEmail(Reviewee,Reviewer, Review)}"></serviceTask>
    <sequenceFlow id="SequenceFlow_2" sourceRef="startProcessEmailServiceTask" targetRef="CompleteSelfFeedbackUserTask"></sequenceFlow>
    <userTask id="CompleteSelfFeedbackUserTask" name="Complete Self Review" activiti:assignee="${Reviewee}"></userTask>
    <sequenceFlow id="SequenceFlow_3" sourceRef="CompleteSelfFeedbackUserTask" targetRef="setSelfFeedbackReady"></sequenceFlow>
    <serviceTask id="setSelfFeedbackReady" name="Set Feedback to Ready" activiti:expression="${feedbackService.setStatusById(RevieweeFeedback,'READY')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_4" sourceRef="setSelfFeedbackReady" targetRef="CompleteReviewerFeedbackUserTask"></sequenceFlow>
    <userTask id="CompleteReviewerFeedbackUserTask" name="Complete Counselor Review" activiti:assignee="${Reviewer}"></userTask>
    <sequenceFlow id="SequenceFlow_5" sourceRef="CompleteReviewerFeedbackUserTask" targetRef="setReviewerFeedbackReady"></sequenceFlow>
    <serviceTask id="setReviewerFeedbackReady" name="Set Feedback to Ready" activiti:expression="${feedbackService.setStatusById(ReviewerFeedback,'READY')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_6" sourceRef="setReviewerFeedbackReady" targetRef="ReviewerCurationUserTask"></sequenceFlow>
    <userTask id="ReviewerCurationUserTask" name="Counselor Curates Peer Feedback" activiti:assignee="${Reviewer}"></userTask>
    <sequenceFlow id="SequenceFlow_7" sourceRef="ReviewerCurationUserTask" targetRef="ReviewerApprovalExclusiveGateway"></sequenceFlow>
    <exclusiveGateway id="ReviewerApprovalExclusiveGateway" name="Reviewers Accept?"></exclusiveGateway>
    <sequenceFlow id="ReviewersAcceptFlow" name="Yes" sourceRef="ReviewerApprovalExclusiveGateway" targetRef="setReviewDirectorApproval">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RESULT == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="ReviewersRejectFlow" name="No" sourceRef="ReviewerApprovalExclusiveGateway" targetRef="rejectReviewToOpen">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RESULT == false}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="setReviewDirectorApproval" name="Set Review to Director Approval" activiti:expression="${reviewService.setStatusById(Review,'DIRECTOR_APPROVAL')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_9" sourceRef="setReviewDirectorApproval" targetRef="DirectorApproval"></sequenceFlow>
    <userTask id="DirectorApproval" name="Director Approval" activiti:assignee="${Director}"></userTask>
    <sequenceFlow id="SequenceFlow_10" sourceRef="DirectorApproval" targetRef="DirectorApprovalExclusiveGateway"></sequenceFlow>
    <exclusiveGateway id="DirectorApprovalExclusiveGateway" name="Review Accepted?"></exclusiveGateway>
    <sequenceFlow id="DirectorAcceptFlow" name="yes" sourceRef="DirectorApprovalExclusiveGateway" targetRef="setReviewJointApproval">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RESULT == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="DirectorRejectFlow" name="No" sourceRef="DirectorApprovalExclusiveGateway" targetRef="rejectReviewToOpen">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RESULT == false}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="setReviewJointApproval" name="Set Review to Joint Approval" activiti:expression="${reviewService.setStatusById(Review,'JOINT_APPROVAL')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_11" sourceRef="setReviewJointApproval" targetRef="JointApprovalParallelFork"></sequenceFlow>
    <parallelGateway id="JointApprovalParallelFork"></parallelGateway>
    <sequenceFlow id="SequenceFlow_12" sourceRef="JointApprovalParallelFork" targetRef="ReviewerJointApproval"></sequenceFlow>
    <sequenceFlow id="SequenceFlow_13" sourceRef="JointApprovalParallelFork" targetRef="RevieweeJointApproval"></sequenceFlow>
    <userTask id="ReviewerJointApproval" name="Joint Review (Reviewer)" activiti:assignee="${Reviewer}"></userTask>
    <userTask id="RevieweeJointApproval" name="Joint Review (Reviewee)" activiti:assignee="${Reviewee}"></userTask>
    <sequenceFlow id="SequenceFlow_14" sourceRef="ReviewerJointApproval" targetRef="JointApprovalParallelJoin"></sequenceFlow>
    <sequenceFlow id="SequenceFlow_15" sourceRef="RevieweeJointApproval" targetRef="JointApprovalParallelJoin"></sequenceFlow>
    <parallelGateway id="JointApprovalParallelJoin"></parallelGateway>
    <sequenceFlow id="SequenceFlow_16" sourceRef="JointApprovalParallelJoin" targetRef="JointApprovalExclusiveGateway"></sequenceFlow>
    <exclusiveGateway id="JointApprovalExclusiveGateway" name="Review Accepted?"></exclusiveGateway>
    <sequenceFlow id="JointAcceptFlow" name="yes" sourceRef="JointApprovalExclusiveGateway" targetRef="setReviewGeneralManagerApproval">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${REVIEWER_RESULT == true and REVIEWEE_RESULT == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="JointRejectFlow" name="No" sourceRef="JointApprovalExclusiveGateway" targetRef="rejectReviewToOpen">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${REVIEWER_RESULT == false or REVIEWEE_RESULT == false}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="setReviewGeneralManagerApproval" name="Set Review to GM Approval" activiti:expression="${reviewService.setStatusById(Review,'GM_APPROVAL')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_17" sourceRef="setReviewGeneralManagerApproval" targetRef="GeneralManagerApproval"></sequenceFlow>
    <userTask id="GeneralManagerApproval" name="General Manager Approval" activiti:assignee="${GeneralManager}"></userTask>
    <sequenceFlow id="SequenceFlow_18" sourceRef="GeneralManagerApproval" targetRef="GeneralManagerApprovalExclusiveGateway"></sequenceFlow>
    <exclusiveGateway id="GeneralManagerApprovalExclusiveGateway" name="Review Accepted?"></exclusiveGateway>
    <sequenceFlow id="GeneralManagerAcceptFlow" name="yes" sourceRef="GeneralManagerApprovalExclusiveGateway" targetRef="setReviewComplete">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RESULT == true}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="GeneralManagerRejectFlow" name="No" sourceRef="GeneralManagerApprovalExclusiveGateway" targetRef="rejectReviewToOpen">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${RESULT == false}]]></conditionExpression>
    </sequenceFlow>
    <serviceTask id="setReviewComplete" name="Set Review to Complete" activiti:expression="${reviewService.setStatusById(Review,'COMPLETE')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_19" sourceRef="setReviewComplete" targetRef="End"></sequenceFlow>
    <endEvent id="End" name="End"></endEvent>
    
    <!-- Rejected Flow -->
    <serviceTask id="rejectReviewToOpen" name="Set Review Back to Open" activiti:expression="${reviewService.setStatusById(Review,'OPEN')}"></serviceTask>
    <sequenceFlow id="SequenceFlow_8" sourceRef="rejectReviewToOpen" targetRef="CompleteSelfFeedbackUserTask"></sequenceFlow>
  </process>
</definitions>