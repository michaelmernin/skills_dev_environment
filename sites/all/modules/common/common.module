<?php

/**
 * @file
 * 
 * This is the Common module you can put Common method in here
 * 
 * 
 */

/**
 * return my counselor and gm name
 * @param type $my_name
 * @return type
 * @author Mars
 */
function my_counselor_gm_name($my_name) {
  $query = db_select('prs_rel_employee_counselor_gm', 'prec');
  $query->fields('prec', array('counselorName', 'gmName'));
  $query->condition('prec.employeeName', $my_name);
  $result = $query->execute()->fetchAll();
  return $result;
}

/**
 * get basic information from db
 * @param type $review_id
 * @return type
 * @author Mars
 */
function get_basic_review_infomation($review_id) {
//   $cur_user_name = get_current_user_name();
  $query = db_select('prs_rel_review_employee', 're');
  $query->join('prs_general', 'pg', 'pg.prid=re.prid');
  $query->fields('re', array('employeeName', 'rreid', 'rstatus'));
  $query->addField('pg', 'period_start');
  $query->addField('pg', 'period_end');
  $query->addField('pg', 'time_frame_from');
  $query->addField('pg', 'time_frame_to');
  $query->addField('pg', 'project_name');
  $query->addField('pg', 'type');
  $query->addField('pg', 'description');
  $query->condition('re.rreid', $review_id);
  $result = $query->execute()->fetchAll();
  return $result;
}

function format_login_name($login_name) {
  $formated_name = '';
  if (strpos($login_name, '.')) {
    $tmp = explode('.', $login_name);
    foreach ($tmp as $value) {
      $formated_name .= ucfirst($value) . ' ';
    }
  }
  else {
    $formated_name = $login_name;
  }
  return trim($formated_name);
}

function get_my_anniversary_counselor() {
  $info = array();
  $my_name = get_current_user_name();
  $my_counselor_gm_name = my_counselor_gm_name($my_name);
  $my_counselor_name = $my_counselor_gm_name[0]->counselorName;
  $my_anniversary_month = my_anniversary_date($my_name);
  $info['my_counselor_name'] = format_login_name($my_counselor_name);
  $info['my_anniversary_month'] = $my_anniversary_month;
  return $info;
}

function my_anniversary_date($login_name) {
  $result = db_select('prs_reviewers', 'pr')->fields('pr', array('account_created'))->condition('login_name', $login_name)->execute()->fetchAll();
  if (count($result) != 0) {
    $a_date = $result[0]->account_created;
    $year = substr($a_date, 0, 4);
    $month = substr($a_date, 4, 2);
    return $year . '/' . $month;
  }
  else {
    return '';
  }
}